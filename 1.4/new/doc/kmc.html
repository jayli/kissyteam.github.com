<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <title>KISSY - 全终端适配的 JS 类库</title>
  <meta name="viewport" content="width=device-width">
  <link href="http://fonts.googleapis.com/css?family=Droid+Sans|Lekton|Ubuntu+Mono:400,700" rel="stylesheet">
	<link rel="stylesheet" href="templates/assets/bootstrap.css">
	<link href="templates/assets/normalize.css" rel="stylesheet">
	<link href="templates/assets/kissy.css" rel="stylesheet">
	<link href="templates/assets/prettify.css" rel="stylesheet">
	<link href="templates/assets/forkit.css" rel="stylesheet">
	<script src="templates/assets/jquery.min.js"></script>
	<script src="templates/assets/script.js" type="text/javascript"></script>
	<script src="http://g.tbcdn.cn/trip/kissy/1.4.0/seed-min.js"></script>
	<script src="api/assets/highlight.pack.js"></script>
	<link href="api/assets/tomorrow-night-bright.css" rel=stylesheet />
	<link rel="shortcut icon" href="http://a.tbcdn.cn/s/kissy/favicon.ico">
</head>

<body class="">
    <nav id="sidebar">
    <header><a href="index.html"><img src="http://gtms04.alicdn.com/tps/i4/T1ceiPFbpcXXcljp_h-200-89.png"></a></header>
    <ul>
      <li class="nav-divider"><a href="index.html"><img src="templates/assets/img/icon-home.png">首页</a></li>
      <li class="nav-divider"><a href="why-kissy.html"><img src="templates/assets/img/icon-why.png">Why KISSY?</a></li>
      <li><a href="get-started.html"><img src="templates/assets/img/icon-getting-started.png">Getting Started (1.4.0)</a></li>
      <li class="nav-sub"><a href="module-map.html">核心模块列表</a></li>
      <li class="nav-sub"><a href="kmd.html">KISSY 模块规范 (KMD)</a></li>
      <li class="nav-sub"><a href="gbs.html">浏览器兼容基准(GBS)</a></li>
      <li class="nav-sub"><a href="http://cyj.me/jquery-kissy-rosetta/">jQuery KISSY 对比手册</a></li>
      <li class="nav-sub"><a href="http://gallery.kissyui.com/guide">KISSY 组件开发规范</a></li>
      <li class="nav-sub nav-divider"><a href="history.html">历史版本</a></li>
      <li><a href="">API Doc</a></li>
      <li><a href="http://demo.kissyui.com">Demos</a></li>
      <li class="nav-divider"><a href="gallery.html">KISSY Gallery</a></li>
      <li><a href="tools.html">KISSY 项目构建工具</a></li>
      <li class="nav-sub"><a href="kmc.html">KS Module Compiler</a></li>
      <li class="nav-sub"><a href="http://abc.f2e.taobao.net">ABC</a></li>
      <li class="nav-sub nav-divider"><a href="clam.html">Clam</a></li>
      <li><a href="third-party-lib.html">第三方代码库</a></li>
      <li class="nav-sub"><a href="">面向第三方安全的 KISSY</a></li>
      <li class="nav-sub"><a href="http://www.builive.com/demo/index.php">BUI</a></li>
      <li class="nav-sub nav-divider"><a href="http://work.tmall.net/muidoc/build/">MUI</a></li>
      <li><a href="">为 KISSY 贡献代码</a></li>
      <li class="nav-sub"><a href="">HTML 编码规范</a></li>
      <li class="nav-sub"><a href="">CSS 编码规范</a></li>
      <li class="nav-sub nav-divider"><a href="">JavaScript 编码规范</a></li>
	  <li><a href=""><img src="templates/assets/img/icon-documentation.png">1.3.x->1.4.0 升级指南</a></li>
	  <li><a href=""><img src="templates/assets/img/icon-faqs.png">FAQ</a></li>
      <li><a href=""><img src="templates/assets/img/icon-github.png">GitHub</a></li>
	  <li><a href=""><img src="templates/assets/img/icon-google-plus.png">KISSY 核心小组</a></li>
    </ul>
  </nav>

  <div id="content">
    <article>
      

	<h1>ModuleCompiler</h1>
<p><a href="http://travis-ci.org/daxingplay/ModuleCompiler"><img src="https://secure.travis-ci.org/daxingplay/ModuleCompiler.png" alt="Build Status"></a></p>
<p><a href="http://badge.fury.io/js/kmc"><img src="https://badge.fury.io/js/kmc.png" alt="NPM version"></a></p>
<h2>简介</h2>
<p>KISSY Module Compiler（kmc）是一个基于NodeJS的KISSY模块打包工具，目前适用于KISSY 1.2+的代码打包</p>
<h2>特点</h2>
<ul>
<li>支持GruntJS，参见<a href="https://github.com/daxingplay/grunt-kmc">grunt-kmc</a>.</li>
<li>基于NodeJS，相比于KISSY自带的Java工具，打包快速</li>
<li>参照浏览器端的KISSY的config进行配置，无需额外知识，只需要改一下包路径即能快速打包</li>
<li>支持混合编码打包，不同的包可以使用不同的编码</li>
<li>支持GBK输出</li>
<li>支持KISSY 1.3的自动combo功能，可以生成依赖关系文件</li>
<li>提供底层依赖分析接口，方便集成到其他工具当中</li>
<li>支持map功能，可以使用正则自由替换输出的模块名</li>
</ul>
<h2>版本说明</h2>
<ul>
<li>0.0.7版本适用于KISSY 1.2、1.3的打包，目前已经在淘宝多个业务广泛使用，单纯打包没有任何问题，但是不具备依赖分析生成功能，此版本已经不再维护，推荐使用新版本。</li>
<li>1.0.0版本开始支持KISSY 1.3的自动combo功能，推荐使用</li>
</ul>
<h2>使用</h2>
<h3>安装</h3>
<pre><code>npm install kmc</code></pre>
<p>or</p>
<pre><code>git clone git://github.com/daxingplay/ModuleCompiler.git</code></pre>
<p><strong>注意</strong>: 新版本的KISSY Module Compiler的npm包已经更名为kmc，如果使用老版本（此版已经不再维护），请<code>npm install module-compiler</code></p>
<h3>编写你的打包脚本</h3>
<pre><code>var kmc = require(&#39;kmc&#39;);

// 这里和KISSY.config一样，先配置包
kmc.config({
    packages: [{
        &#39;name&#39;: &#39;sh&#39;,
        &#39;path&#39;: &#39;这里建议写绝对路径，即sh这个包所在的目录&#39;,
        &#39;charset&#39;: &#39;gbk&#39;
    }]
});

// 将xxx.js打包为xxx.combine.js，输出编码为GBK
kmc.build(&#39;xxx.js&#39;, &#39;xxx.combine.js&#39;, &#39;gbk&#39;);

// 用node执行你这个打包脚本就ok啦～</code></pre>
<h3>高级使用指南</h3>
<pre><code>var kmc = require(&#39;kmc&#39;);

kmc.config({
    // 和KISSY一样，可以配置多个包
    packages: [{
        &#39;name&#39;: &#39;app1&#39;,
        &#39;path&#39;: &#39;app1这个包所在目录的绝对路径&#39;,
        // 这里是指app1这个包中的文件的编码，同一个包内的编码请保持一致
        &#39;charset&#39;: &#39;gbk&#39;
    }, {
        &#39;name&#39;: &#39;app2&#39;,
        &#39;path&#39;: &#39;app2这个包所在目录的绝对路径&#39;,
        // 这里是指app2这个包源码的编码
        &#39;charset&#39;: &#39;utf-8&#39;
    }],
    // 可以设置哪些模块不打包进来。注意，这里exclude的是具体的模块名，支持正则
    exclude: [&#39;base&#39;, &#39;event&#39;],
    // 如果是对一个目录下的所有文件进行打包，可以设置哪些文件不打包进来，支持正则。注意和上面的exclude的配置的区别。
    ignoreFiles: [&#39;.combo.js&#39;, &#39;-min.js&#39;],
    // 输出的文件名后缀，不带.js，比如打包后你想输出为xxx.combine.js，那么这里就配置为：.combine
    suffix: &#39;&#39;,
    // 类似于KISSY的map方法，可以自己定义把模块名中的路径进行替换
    map: [
        // 这样配置的话，那么，如果原先输出的app1的模块名中含有app1/2.0/字样的话，就会被替换成app1/19891014/
        [&#39;app1/2.0/&#39;, &#39;app1/19891014/&#39;]
    ],
    // 这里设置的是最后打包出来的文件的编码，默认UTF-8，这里的设置相当于是全局设置，下面build中的设置是针对单一打包实例的
    charset: &#39;gbk&#39;
});

/**
 * 打包一个文件/目录
 * @param inputPath {String} 源文件/目录的绝对路径.
 * @param outputPath {String} 打包出来的文件/目录的路径.
 * @param outputCharset {String} 输出编码，这里的设置会覆盖config.charset中的设置，默认UTF-8
 * @return {Object} 打包出来的文件信息
 */
kmc.build(&#39;xxx.js&#39;, &#39;xxx.combine.js&#39;, &#39;gbk&#39;);</code></pre>
<p>更详细的文档，请参见<a href="https://github.com/daxingplay/ModuleCompiler/wiki">wiki</a>。</p>
<h3>API汇总</h3>
<ul>
<li>kmc.config(cfg)：配置包，返回当前所有配置信息。如果不带参数，直接返回当前所有配置信息。</li>
<li>kmc.analyze(inputPath)：只分析该文件依赖，不打包。</li>
<li>kmc.build(inputPath, outputPath, outputCharset, depFilePath)：打包函数，具体见wiki</li>
<li>kmc.combo(inputPath, depFilePath, depFileCharset): 不打包，只生成KISSY 1.3的自动combo依赖文件</li>
<li>kmc.clean(): 可以清空config中的设置。因为ModuleCompiler是单例运行，所以如果出现一些特别情况，可以在config前执行clean方法清空之前的配置。</li>
</ul>
<h2>CHANGELOG</h2>
<p><a href="https://github.com/daxingplay/ModuleCompiler/blob/master/HISTORY.md">版本更新记录</a></p>
<h2>License</h2>
<p>遵守 &quot;MIT&quot;：https://github.com/daxingplay/ModuleCompiler/blob/master/LICENSE.md 协议</p>


      
  <style>
	.github-btn {
		border: 0 none;
		overflow: hidden;
		margin-top:4px;
	}
	footer {
		border-top:1px solid #e2e2e2;
		padding-top:20px;
		clear:both;
	}
	/* iPhone 及以下 */
	@media only screen and (max-width: 767px) {
		.github-link {
			display:none;
		}
	}
  </style>
  <footer>
	<div class="text-center">
		©2013 - 2033 KISSY UI LIBRARY
		<br /> <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=kissyteam&amp;repo=kissy&amp;type=watch&amp;count=true" width="100" height="20" title="Star on GitHub"></iframe> 
	<iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=kissyteam&amp;repo=kissy&amp;type=fork&amp;count=true" width="102" height="20" title="Fork on GitHub"></iframe>
	</div>
  </footer>
    </article>
  </div>
  <a target="_blank" href="https://github.com/kissyteam/kissy" class="github-link"><img alt="Fork me on GitHub" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" style="position: absolute; top: 0; right: 0; border: 0; z-index: 50"></a>
  <script>
	var S = KISSY;
	(function(){
		S.use('node',function(S){
			S.all('code').each(function(node){
				var className = node.attr('class');
				if(/^lang-/.test(className)){
					var tc = className.replace(/^lang-/,'');
					node.replaceClass(className,tc);
				}
			});
			hljs.tabReplace = '    ';
			hljs.initHighlighting();
		});
	})();
	(function(){
		var h3s = document.getElementsByTagName('h3');
		for(var i = 0;i<h3s.length;i++){
			var str = S.trim(h3s[i].innerHTML);
			try{
				str = str.match(/\w+/)[0];
			}catch(e){
				continue;
			}
			h3s[i].innerHTML = '<a name="'+str+'"></a>' + h3s[i].innerHTML;
		}
	})();
  </script>
</body>
</html>
